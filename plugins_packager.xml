<?xml version="1.0" encoding="UTF-8"?>
<!-- ==================================================================  -->
<!-- redSLIDER 2.0 packager                                              -->
<!-- This PHING build file generates the redSLIDER 2.0 Plugins package   -->
<!-- To use in your environment do the following steps:                  -->
<!--    Change the following variables in build.properties file          -->
<!--            (copy variables from build.properties.dist )             -->
<!--    - change the version in variable comp.version                    -->
<!--    - change the source folder path in variable repo.dir             -->
<!--    - change the package folder path in variable package.dir         -->
<!--    - execute this PHING build file                                  -->
<!-- ==================================================================  -->

<project name="modules packager" basedir="." default="main">

	<!-- Do initialization stuff -->
	<property file="build.properties" override="true"/>

    <!-- Name of extension -->
    <property name="extension" value="${comp.name}" override="true"/>

    <!-- Load extension property in XML file -->
    <xmlproperty file="${project.basedir}/${extension}.xml" prefix="extensionDetails" keepRoot="false" />

    <!-- Get extension version from XML -->
    <property
            name="version"
            value="${extensionDetails.version}"
            override="true"/>

	<!-- Folder where the redSLIDER 2.0 repository PLUGINS are located  -->
	<property
			name="extpath"
			value="${project.basedir}/plugins"
			override="true" />

	<!-- Target dir where module packages will be created  -->
	<property
			name="targetdir"
			value="${package.dir}/redSLIDER2-Plugins"
			override="true" />

	<!-- MAIN -->
	<target name="main" description="Loops through folders of plugin groups">

		<!-- Cleanup build area -->
		<delete dir="${targetdir}" />
		<mkdir dir="${targetdir}" />

		<!-- Loop through plugins groups -->
		<foreach param="group_name" target="plugin_loop">
			<fileset dir="${extpath}">
				<type type="dir" />
				<depth max="0" min="0" />
			</fileset>
		</foreach>

        <!-- clean up plugins already added in the main extension package -->
        <delete file="${targetdir}/redslider_sections/plg_redslider_sections_section_standard_${version}.zip" />
        <delete file="${targetdir}/redslider_sections/plg_redslider_sections_section_article_${version}.zip" />
        <delete file="${targetdir}/redslider_sections/plg_redslider_sections_section_video_${version}.zip" />
    </target>

	<target name="plugin_loop" description="Loops through plugins folders inside groups">

		<!-- Loop through plugins -->
		<foreach param="plugin_name" target="plugin_packager">
			<fileset dir="${extpath}/${group_name}">
				<type type="dir" />
				<depth max="0" min="0" />
			</fileset>
		</foreach>

	</target>

	<target name="plugin_packager" description="Packages the extension for delivery">


		<mkdir dir="${targetdir}/${group_name}/${plugin_name}" />
		<zip destfile="${targetdir}/${group_name}/plg_${group_name}_${plugin_name}_${version}.zip"
			basedir="${extpath}/${group_name}/${plugin_name}">
			<fileset dir="${extpath}/${group_name}/${plugin_name}">
				<include name="**" />
				<exclude name=".*" />
			</fileset>
		</zip>

		<!-- clean up temporary folder -->
		<delete dir="${targetdir}/${group_name}/${plugin_name}" />
    </target>

</project>